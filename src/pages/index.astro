---
import { Image } from 'astro:assets'

import { getBlogCollection } from 'astro-pure/server'
import { Button, Card, Icon } from 'astro-pure/user'
import PageLayout from '@/layouts/BaseLayout.astro'
import Section from '@/components/home/Section.astro'
import config from '@/site-config'

// 统计数据
const allPosts = await getBlogCollection()
const totalPosts = allPosts.length
const totalWords = allPosts.reduce((acc, post) => {
  const content = post.body || ''
  return acc + content.length
}, 0)
const totalWordsDisplay = totalWords > 10000 ? `${(totalWords / 10000).toFixed(1)}w` : totalWords.toString()

const githubUser = 'huang2202'
const githubChartColor = '39d353'

// 计算网站上线天数 (可以改成你的网站上线日期)
const siteStartDate = new Date('2025-11-10')
const today = new Date()
const daysOnline = Math.floor((today.getTime() - siteStartDate.getTime()) / (1000 * 60 * 60 * 24))

const imagePath = config.logo.src
const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/*.{jpeg,jpg,png,gif,avif,webp}'
)
if (!images[imagePath])
  throw new Error(
    `"${imagePath}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif,avif,webp}"`
  )
---

<PageLayout meta={{ title: 'Home', description: config.description }} highlightColor='#659EB9'>
  <main class='flex w-full flex-col items-center'>
    <!-- Header: Avatar + Name + Social Links -->
    <section class='animate mb-10 flex flex-col items-center gap-y-5 sm:flex-row sm:gap-x-8' id='content-header'>
      <Image
        src={images[imagePath]()}
        alt={config.logo.alt || 'Profile'}
        class='h-32 w-32 rounded-lg object-cover'
        loading='eager'
        fetchpriority='high'
      />

      <div class='flex flex-col items-center gap-y-4 sm:items-start'>
        <h1 class='text-3xl font-bold'>{config.author}</h1>
        <div class='flex flex-wrap justify-center gap-2 sm:justify-start'>
          <!-- TODO: 修改为你自己的社交链接 -->
          <a
            href='#'
            class='inline-flex items-center gap-1.5 rounded-full border bg-background px-3 py-1.5 text-sm transition-colors hover:bg-muted'
          >
            <Icon name='location' class='size-4' />
            <span>China</span>
          </a>
          <a
            href='https://github.com/huang2202'
            target='_blank'
            class='inline-flex items-center gap-1.5 rounded-full border bg-background px-3 py-1.5 text-sm transition-colors hover:bg-muted'
          >
            <Icon name='github' class='size-4' />
            <span>Github</span>
          </a>
          <a
            href='mailto:zju_hgy@163.com'
            class='inline-flex items-center gap-1.5 rounded-full border bg-background px-3 py-1.5 text-sm transition-colors hover:bg-muted'
          >
            <Icon name='email' class='size-4' />
            <span>Email</span>
          </a>
          <a
            href='https://scholar.google.com/'
            target='_blank'
            class='inline-flex items-center gap-1.5 rounded-full border bg-background px-3 py-1.5 text-sm transition-colors hover:bg-muted'
          >
            <svg class='size-4' viewBox='0 0 24 24' fill='currentColor'>
              <path d='M12 24a7 7 0 1 1 0-14 7 7 0 0 1 0 14Zm0-24L0 9.5l4.838 3.94A8 8 0 0 1 12 9a8 8 0 0 1 7.162 4.44L24 9.5 12 0Z'/>
            </svg>
            <span>Scholar</span>
          </a>
        </div>
      </div>
    </section>

    <div id='content' class='animate flex w-full flex-col gap-y-10 md:w-4/5 lg:w-5/6'>
      <!-- About Section -->
      <Section title='About'>
        <p class='text-muted-foreground'>
          <!-- TODO: 修改为你自己的简介 -->
          Student / Learner
        </p>
        <p class='text-muted-foreground'>
          我本科就读于西安交通大学人工智能专业，目前大四在浙江大学提前进组工作中，后准备前往ZGCA加入项目组，interested in Embodied AI and RL。
        </p>
        <Button title='More about me' class='w-fit self-end' href='/about' variant='ahead' />
      </Section>

      <!-- Education Section -->
      <Section title='Education'>
        <!-- TODO: 修改为你自己的教育/工作经历 -->
        <Card
          heading='浙江大学CAG&CG实验室'
          subheading='直博生'
          date='Sep 2025 - Present'
        />
        <Card
          heading='西安交通大学'
          subheading='人工智能专业，本科'
          date='Sep 2022 - Sep 2026'
        />
      </Section>

      <!-- Statistics Section -->
      <Section title='Statistics'>
        <div class='grid grid-cols-3 gap-4'>
          <div class='flex flex-col items-center rounded-lg border bg-background p-4'>
            <svg class='mb-2 size-5 text-muted-foreground' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'>
              <circle cx='12' cy='12' r='10'/>
              <polyline points='12,6 12,12 16,14'/>
            </svg>
            <span class='text-2xl font-bold'>{daysOnline}</span>
            <span class='text-sm text-muted-foreground'>Days Online</span>
          </div>
          <div class='flex flex-col items-center rounded-lg border bg-background p-4'>
            <svg class='mb-2 size-5 text-muted-foreground' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'>
              <rect x='3' y='4' width='18' height='18' rx='2' ry='2'/>
              <line x1='16' y1='2' x2='16' y2='6'/>
              <line x1='8' y1='2' x2='8' y2='6'/>
              <line x1='3' y1='10' x2='21' y2='10'/>
            </svg>
            <span class='text-2xl font-bold'>{today.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
            <span class='text-sm text-muted-foreground'>Last Updated</span>
          </div>
          <div class='flex flex-col items-center rounded-lg border bg-background p-4'>
            <svg class='mb-2 size-5 text-muted-foreground' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'>
              <path d='M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z'/>
              <polyline points='14,2 14,8 20,8'/>
              <line x1='16' y1='13' x2='8' y2='13'/>
              <line x1='16' y1='17' x2='8' y2='17'/>
            </svg>
            <span class='text-2xl font-bold'>{totalWordsDisplay}</span>
            <span class='text-sm text-muted-foreground'>Total Words</span>
          </div>
        </div>
        <div class='mt-4 flex items-center justify-between text-sm text-muted-foreground'>
          <span>Total Posts</span>
          <span class='font-medium'>{totalPosts}</span>
        </div>
      </Section>

      <Section title='GitHub Activities'>
        <p class='text-muted-foreground'>
          <a href={`https://github.com/${githubUser}`} target='_blank' rel='noreferrer'>
            @{githubUser}
          </a>
        </p>
        <div class='not-prose overflow-x-auto rounded-lg border bg-background p-4'>
          <Image
            src={`https://ghchart.rshah.org/${githubChartColor}/${githubUser}`}
            alt='github contributions'
            inferSize
            loading='lazy'
          />
        </div>
      </Section>
    </div>
  </main>
</PageLayout>
